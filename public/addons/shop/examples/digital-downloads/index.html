<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Selling digital downloads - Perch CMS documentation</title>
  <meta name="description" content="Perch documentation">
  <meta property="og:title" content="Selling digital downloads">
  <meta property="og:description" content="Perch documentation">
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <link href="/assets/css/docs.css" rel="stylesheet">
  <script type="text/javascript" src="//use.typekit.net/kiw6gix.js"></script>
    <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
  

</head>
<body>
  <nav class="global-bar show-for-small-only">
    <ul class="nav-products">
        <li class="docs"><a href="https://docs.grabaperch.com">Docs</a></li>
    </ul>
    <a href="?nav=show" class="hamburger">â˜°</a>
</nav>
<nav class="global-bar primary show-for-medium">
    <ul class="nav-products">
        <li class="perch"><a href="https://grabaperch.com">Perch</a></li>
        <li class="runway"><a href="https://perchrunway.com">Runway</a></li>
        <li class="shop"><a href="https://shop.perchcms.com">Perch Shop</a></li>
        <li class="addons first-right"><a href="https://grabaperch.com/add-ons">Add-ons</a></li>
        <li class="selected docs"><a href="https://docs.grabaperch.com">Docs</a></li>
        <li class="support"><a href="https://community.perchcms.com/forum/">Support</a></li>
        <li class="account"><a href="https://account.perchcms.com">Account</a></li>
    </ul>
</nav>
<nav class="site-nav">
    <ul>
        <li class="home-link"><a href="/perch/">Perch Docs</a></li>
        <li><a href="/runway/">Runway Docs</a></li>
        <li><a href="/video/">Video</a></li>
        <li><a href="/templates/">Template Reference</a></li>
        <li><a href="/functions/">Function Reference</a></li>
        <li class="selected"><a href="/addons/">Add-ons</a></li>
        <li><a href="/api/">API</a></li>
    </ul>

    <div class="global-search" role="search">
      <div class="gcse-searchbox"></div>
    </div>

    <style>
      .custom-search {
        with
      }
  
      table.gsc-input {
        margin: 0;
        height: 1.5em;
      }

      form.gsc-search-box {
        margin: 0;
      }

      .gsc-search-box tbody {
        border: none;
      }

      .gsc-search-box tbody td {
        padding: 0;
      }

      .gsc-control-cse {
        padding: 0;
      }

      .gsc-input-box {
        border: none;
      }

      .gsc-search-box a {
        padding: 0;
      }
    </style>
</nav>

<div class="gcse-searchresults"></div>
<main class="wrapper">
    <nav class="sidebar">
    <ul class="sidenav">
                        <li>
                            <a href="/addons/announcements/">Announcements App</a>
                             
                             
                             
                        </li>
                        <li>
                            <a href="/addons/backup/">Backup App</a>
                             
                             
                        </li>
                        <li>
                            <a href="/addons/blog/">Blog App</a>
                             
                             
                             
                             
                             
                             
                             
                             
                             
                        </li>
                        <li>
                            <a href="/addons/comments/">Comments App</a>
                             
                             
                             
                             
                        </li>
                        <li>
                            <a href="/addons/email_octopus/">EmailOctopus App</a>
                             
                             
                        </li>
                        <li>
                            <a href="/addons/events/">Events App</a>
                             
                             
                             
                             
                             
                             
                             
                        </li>
                        <li>
                            <a href="/addons/feathers/">Feathers</a>
                        </li>
                        <li>
                            <a href="/addons/field-types/">Field Types</a>
                             
                        </li>
                        <li>
                            <a href="/addons/forms/">Forms App</a>
                             
                             
                             
                             
                        </li>
                        <li>
                            <a href="/addons/gallery/">Gallery App</a>
                             
                             
                             
                             
                        </li>
                        <li>
                            <a href="/addons/kraken/">Kraken App</a>
                             
                             
                             
                        </li>
                        <li>
                            <a href="/addons/listings/">Listings App</a>
                             
                             
                             
                        </li>
                        <li>
                            <a href="/addons/mailchimp/">Mailchimp App</a>
                             
                             
                             
                             
                        </li>
                        <li>
                            <a href="/addons/members/">Members App</a>
                             
                             
                             
                             
                        </li>
                        <li>
                            <a href="/addons/plugins/">Plugins</a>
                             
                             
                        </li>
                        <li>
                            <a href="/addons/podcasts/">Podcasts App</a>
                             
                             
                             
                        </li>
                        <li>
                            <a href="/addons/poll/">Poll App</a>
                             
                             
                             
                             
                        </li>
                        <li>
                            <a href="/addons/qr/">QRGenerator App</a>
                             
                             
                             
                        </li>
                        <li>
                            <a href="/addons/shop-foxycart/">Foxycart Shop App</a>
                             
                             
                             
                        </li>
                        <li>
                            <a href="/addons/shop-paypal/">PayPal Shop App</a>
                             
                             
                             
                        </li>
                        <li>
                            <a href="/addons/shop/">Shop App</a>
                            <ul>    <li>
                            <a href="/addons/shop/cart/">The Cart</a>
                        </li>
                    </ul>
                            <ul>    <li>
                            <a href="/addons/shop/changelog/">Changelog</a>
                        </li>
                    </ul>
                            <ul>    <li>
                            <a href="/addons/shop/checkout/">Checkout</a>
                        </li>
                    </ul>
                            <ul>    <li>
                            <a href="/addons/shop/customers/">Customers</a>
                        </li>
                    </ul>
                            <ul>    <li>
                            <a href="/addons/shop/examples/">Examples</a>
                            <ul>    <li>
                            <a href="/addons/shop/examples/add-to-cart-options/">Add to Cart with Options</a>
                        </li>
                    </ul>
                            <ul>    <li>
                            <a href="/addons/shop/examples/add-to-cart-php/">Add to Cart Function</a>
                        </li>
                    </ul>
                            <ul>    <li>
                            <a href="/addons/shop/examples/create-account/">Create a customer account</a>
                        </li>
                    </ul>
                            <ul>    <li>
                            <a href="/addons/shop/examples/digital-downloads/" class="selected">Selling digital downloads</a>
                        </li>
                    </ul>
                            <ul>    <li>
                            <a href="/addons/shop/examples/display-cart/">Display the Cart</a>
                        </li>
                    </ul>
                            <ul>    <li>
                            <a href="/addons/shop/examples/empty-cart/">Empty the Cart</a>
                        </li>
                    </ul>
                            <ul>    <li>
                            <a href="/addons/shop/examples/managing-addresses/">Managing addresses</a>
                        </li>
                    </ul>
                            <ul>    <li>
                            <a href="/addons/shop/examples/no-account/">Paying without creating an account</a>
                        </li>
                    </ul>
                            <ul>    <li>
                            <a href="/addons/shop/examples/no-cart/">Creating a checkout without a cart</a>
                        </li>
                    </ul>
                            <ul>    <li>
                            <a href="/addons/shop/examples/order-confirmation/">Creating an order confirmation step</a>
                        </li>
                    </ul>
                            <ul>    <li>
                            <a href="/addons/shop/examples/payment-result/">Handling payment results</a>
                        </li>
                    </ul>
                            <ul>    <li>
                            <a href="/addons/shop/examples/sell-content-behind-a-paywall/">Sell content behind a paywall</a>
                        </li>
                    </ul>
                            <ul>    <li>
                            <a href="/addons/shop/examples/simple-add-to-cart-form/">Simple Add to Cart Form</a>
                        </li>
                    </ul>
                        </li>
                    </ul>
                            <ul>    <li>
                            <a href="/addons/shop/gateways/">Payment Gateways</a>
                             
                             
                             
                             
                             
                             
                             
                             
                             
                        </li>
                    </ul>
                            <ul>    <li>
                            <a href="/addons/shop/installation/">Installation</a>
                        </li>
                    </ul>
                            <ul>    <li>
                            <a href="/addons/shop/orders/">Orders</a>
                        </li>
                    </ul>
                            <ul>    <li>
                            <a href="/addons/shop/products/">Products</a>
                        </li>
                    </ul>
                            <ul>    <li>
                            <a href="/addons/shop/requirements/">Requirements</a>
                        </li>
                    </ul>
                            <ul>    <li>
                            <a href="/addons/shop/shipping/">Shipping</a>
                        </li>
                    </ul>
                            <ul>    <li>
                            <a href="/addons/shop/tax/">Tax</a>
                             
                             
                        </li>
                    </ul>
                            <ul>    <li>
                            <a href="/addons/shop/updating/">Updating</a>
                        </li>
                    </ul>
                        </li>
                        <li>
                            <a href="/addons/twillio/">Twilio App</a>
                             
                             
                             
                        </li>
                        <li>
                            <a href="/addons/twitter/">Twitter App</a>
                             
                             
                             
                             
                             
                             
                        </li>
    </ul>  </nav>

<article class="content">


  <h1>Selling digital downloads</h1>

  <p>If you are selling digital products, you will need to offer the customer some way to see and download their purchases after checkout. You may even want to make this part of an account area where customers can return and access products theyâ€™ve purchased in the past.</p>
<h2 id="listing-the-files-the-customer-has-purchased">Listing the files the customer has purchased</h2>
<p>You can use the <code>perch_shop_purchased_files()</code> function to output a list of files the customer has purchased, sorted by product the files belong two. (For example, if the use has purchased an ebook, they might have available files in Epub and Mobi format.)</p>
<pre><code class="lang-php">&lt;?php
  perch_shop_purchased_files();
?&gt;
</code></pre>
<p>The default template used for the listing is <code>shop/products/files_list.html</code>. You can copy and edit this template, or specify your own.</p>
<pre><code class="lang-php">&lt;?php
  perch_shop_purchased_files([
    &#39;template&#39; =&gt; &#39;my_template.html&#39;,
  ]);
?&gt;
</code></pre>
<h2 id="setting-up-the-resource-bucket">Setting up the resource bucket</h2>
<p>You;ll need to create a new bucket that stores its files outside the web root. If you donâ€™t have a <code>perch/config/buckets.php</code> file, create one like the example below. The <code>secure</code> folder (or whatever you choose to call it) should be above the <code>public_html</code> folder, i.e. outside of your web root, so that customers canâ€™t download the file without paying.</p>
<pre><code class="lang-php">&lt;?php
  return [
    &#39;secure&#39; =&gt; [
      &#39;web_path&#39;  =&gt; &#39;/shop/deliver/&#39;,
      &#39;file_path&#39; =&gt; &#39;/path/to/sites/secure&#39;,
    ],
  ];
?&gt;
</code></pre>
<p>One your bucket is configured, update your copy of the <code>shop/products/file.html</code> template to add your bucket to the file upload field</p>
<pre><code class="lang-html">&lt;perch:shop id=&quot;file&quot; label=&quot;File&quot; type=&quot;file&quot; order=&quot;2&quot; bucket=&quot;secure&quot;&gt;
</code></pre>
<p>The items in the listing will typically link to a special page for delivering the secure download.</p>
<pre><code class="lang-html">&lt;a href=&quot;/shop/deliver/1234&quot;&gt;Download&lt;/a&gt;
</code></pre>
<h2 id="the-secure-download-page">The secure download page</h2>
<p>Your download page needs to read in the file ID from the URL, check that the customer has permission to access the file, and then deliver it.</p>
<p>For example, if your page route is <code>shop/deliver/[i:file]</code> then the following would be all that is required.</p>
<pre><code class="lang-php">&lt;?php
  // config
  $url_param      = &#39;file&#39;;

  // Check a member is logged in and has purchased the file
  if (perch_member_logged_in()) {
    if (perch_shop_customer_has_purchased_file(perch_get($url_param))) {
      perch_shop_download_file(perch_get($url_param));
    }
  }

  exit;
</code></pre>

</article>




</main>
<footer>
</footer>
<script async src="https://cse.google.com/cse.js?cx=007560778035763025039:043iekruiov"></script>
<script src="/assets/js/prism.js" async defer></script>
<script>
    if ("classList" in document.createElement("_")) {
        var hb = document.querySelectorAll('.hamburger');
        if (hb.length) {
            hb[0].addEventListener('click', function(e) {
                e.preventDefault();
                var nav = document.querySelectorAll('nav.primary')[0];
                if (!nav.classList.contains('show')) {
                    nav.classList.remove('show-for-medium', 'hide');
                    nav.classList.add('show');
                } else {
                    nav.classList.remove('show');
                    nav.classList.add('hide');
                }
            });
        }
    }


        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-8618320-3']);
        _gaq.push(['_trackPageview']);

        (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();

</script>
</body>
</html>
