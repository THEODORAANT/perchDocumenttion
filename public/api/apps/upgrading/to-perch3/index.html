<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Upgrading from Perch 2 to Perch 3 - Perch CMS documentation</title>
  <meta name="description" content="Perch documentation">
  <meta property="og:title" content="Upgrading from Perch 2 to Perch 3">
  <meta property="og:description" content="Perch documentation">
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <link href="/assets/css/docs.css" rel="stylesheet">
  <script type="text/javascript" src="//use.typekit.net/kiw6gix.js"></script>
    <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
  

</head>
<body>
  <nav class="global-bar show-for-small-only">
    <ul class="nav-products">
        <li class="docs"><a href="https://docs.grabaperch.com">Docs</a></li>
    </ul>
    <a href="?nav=show" class="hamburger">☰</a>
</nav>
<nav class="global-bar primary show-for-medium">
    <ul class="nav-products">
        <li class="perch"><a href="https://grabaperch.com">Perch</a></li>
        <li class="runway"><a href="https://perchrunway.com">Runway</a></li>
        <li class="shop"><a href="https://shop.perchcms.com">Perch Shop</a></li>
        <li class="addons first-right"><a href="https://grabaperch.com/add-ons">Add-ons</a></li>
        <li class="selected docs"><a href="https://docs.grabaperch.com">Docs</a></li>
        <li class="support"><a href="https://community.perchcms.com/forum/">Support</a></li>
        <li class="account"><a href="https://account.perchcms.com">Account</a></li>
    </ul>
</nav>
<nav class="site-nav">
    <ul>
        <li class="home-link"><a href="/perch/">Perch Docs</a></li>
        <li><a href="/runway/">Runway Docs</a></li>
        <li><a href="/video/">Video</a></li>
        <li><a href="/templates/">Template Reference</a></li>
        <li><a href="/functions/">Function Reference</a></li>
        <li><a href="/addons/">Add-ons</a></li>
        <li class="selected"><a href="/api/">API</a></li>
    </ul>

    <div class="global-search" role="search">
      <div class="gcse-searchbox"></div>
    </div>

    <style>
      .custom-search {
        with
      }
  
      table.gsc-input {
        margin: 0;
        height: 1.5em;
      }

      form.gsc-search-box {
        margin: 0;
      }

      .gsc-search-box tbody {
        border: none;
      }

      .gsc-search-box tbody td {
        padding: 0;
      }

      .gsc-control-cse {
        padding: 0;
      }

      .gsc-input-box {
        border: none;
      }

      .gsc-search-box a {
        padding: 0;
      }
    </style>
</nav>

<div class="gcse-searchresults"></div>
<main class="wrapper">
    <nav class="sidebar">
    <ul class="sidenav">
                        <li>
                            <a href="/api/apps/">Apps</a>
                            <ul>    <li>
                            <a href="/api/apps/registering/">Registering</a>
                        </li>
                    </ul>
                            <ul>    <li>
                            <a href="/api/apps/activating/">Activation</a>
                        </li>
                    </ul>
                            <ul>    <li>
                            <a href="/api/apps/settings/">Adding Settings</a>
                        </li>
                    </ul>
                            <ul>    <li>
                            <a href="/api/apps/runtime-functions/">Runtime functions</a>
                        </li>
                    </ul>
                            <ul>    <li>
                            <a href="/api/apps/field-types/">Field types</a>
                        </li>
                    </ul>
                            <ul>    <li>
                            <a href="/api/apps/scheduled-tasks/">Scheduled tasks</a>
                        </li>
                    </ul>
                            <ul>    <li>
                            <a href="/api/apps/upgrading/">Upgrading</a>
                            <ul>    <li>
                            <a href="/api/apps/upgrading/to-perch2/">Upgrading from Perch 1 to Perch 2</a>
                        </li>
                    </ul>
                            <ul>    <li>
                            <a href="/api/apps/upgrading/to-perch3/" class="selected">Upgrading from Perch 2 to Perch 3</a>
                        </li>
                    </ul>
                        </li>
                    </ul>
                        </li>
                        <li>
                            <a href="/api/auth/">Authentication plugins</a>
                        </li>
                        <li>
                            <a href="/api/buckets/">Bucket handlers</a>
                        </li>
                        <li>
                            <a href="/api/custom-ui/">UI Customisations</a>
                        </li>
                        <li>
                            <a href="/api/dashboard/">Dashboard Widgets</a>
                        </li>
                        <li>
                            <a href="/api/editors/">Editor plugins</a>
                        </li>
                        <li>
                            <a href="/api/events/">Event hooks</a>
                             
                        </li>
                        <li>
                            <a href="/api/template-filters/">Template filters</a>
                        </li>
                        <li>
                            <a href="/api/templates/">Template handlers</a>
                        </li>
                        <li>
                            <a href="/api/field-types/">Field Types</a>
                        </li>
                        <li>
                            <a href="/api/validators/">Form validators</a>
                        </li>
                        <li>
                            <a href="/api/search/">Search handlers</a>
                        </li>
                        <li>
                            <a href="/api/shortcodes/">Shortcode providers</a>
                        </li>
                        <li>
                            <a href="/api/translations/">Translations</a>
                        </li>
                        <li>
                            <a href="/api/feathers/">Feathers</a>
                        </li>
                        <li>
                            <a href="/api/import/">Importing Content</a>
                             
                             
                             
                             
                        </li>
                        <li>
                            <a href="/api/reference/">API Reference</a>
                             
                             
                             
                             
                             
                             
                             
                             
                             
                             
                             
                             
                        </li>
    </ul>  </nav>

<article class="content">


  <h1>Upgrading from Perch 2 to Perch 3</h1>

  <p>Below is an overview of the steps required to update a Perch 2 app to work with the user interface changes and new APIs in Perch and Runway 3.</p>
<h2 id="your-app-s-admin-php-file">Your app’s <code>admin.php</code> file</h2>
<p>Update minimum version to 3    </p>
<pre><code class="lang-php">$this-&gt;require_version(&#39;perch_blog&#39;, &#39;3.0&#39;);
</code></pre>
<h2 id="sub-navigation">Sub-navigation</h2>
<p>Perch 2 subnav (typically in a <code>modes/_subnav.php</code> file) looks like this:</p>
<pre><code class="lang-php">echo $HTML-&gt;subnav($CurrentUser, array(
        array(
            &#39;page&#39; =&gt; &#39;my_app&#39;,
            &#39;label&#39;=&gt; &#39;Add/Edit&#39;
        ),
    ));
</code></pre>
<p>Update with the new subnav API:</p>
<pre><code class="lang-php">PerchUI::set_subnav([
        [
            &#39;page&#39; =&gt; &#39;my_app&#39;,
            &#39;label&#39;=&gt; &#39;Add/Edit&#39;
        ],
    ], $CurrentUser);
</code></pre>
<p>The array structure remains the same, it just needs to be passed to <code>PerchUI::set_subnav()</code> instead of <code>$HTML-&gt;subnav()</code>.</p>
<h2 id="your-editing-pages-index-php-files">Your editing pages’ <code>index.php</code> files</h2>
<p>Declaring the subnav in the above new style won’t output it directlyh like the old method did. For the subnav to be output in the sidebar (where we want it) you need to update your <code>index.php</code> pages. Before you include your <code>pre.php</code> file, include your subnav:</p>
<pre><code class="lang-php">include(&#39;modes/_subnav.php&#39;);
include(&#39;modes/list.pre.php&#39;);
</code></pre>
<p>You’ll want to do that in all of your app’s <code>index.php</code> files. Most pages will also need instances of the API, HTML, Lang and Paging classes, so it might be a good idea to add those to your <code>index.php</code> too.</p>
<pre><code class="lang-php">$API    = new PerchAPI(1.0, &#39;my_app&#39;);
$HTML   = $API-&gt;get(&#39;HTML&#39;);
$Lang   = $API-&gt;get(&#39;Lang&#39;);
$Paging = $API-&gt;get(&#39;Paging&#39;);
</code></pre>
<h2 id="each-view-s-post-php-file">Each view’s <code>post.php</code> file</h2>
<p>Remove <code>$HTML-&gt;side_panel_start()</code> and <code>$HTML-&gt;side_panel_end()</code> and everything in between them.</p>
<p>Remove <code>$HTML-&gt;main_panel_start()</code> and <code>$HTML-&gt;main_panel_end()</code>.</p>
<p>Remove any <code>_subnav.php</code> include.</p>
<h3 id="title-panel">Title panel</h3>
<p>The title panel is the area encompassing the main heading and any “add new” button. If you have a main heading output with <code>$HTML-&gt;heading1()</code> and a button, you’ll be replacing those with the new <code>$HTML-&gt;title_panel()</code> method.</p>
<pre><code class="lang-php">echo $HTML-&gt;title_panel([
    &#39;heading&#39; =&gt; $Lang-&gt;get(&#39;My awesome app&#39;),
    &#39;button&#39;  =&gt; [
            &#39;text&#39; =&gt; $Lang-&gt;get(&#39;Add new&#39;),
            &#39;link&#39; =&gt; $API-&gt;app_nav().&#39;/edit/&#39;,
            &#39;icon&#39; =&gt; &#39;core/plus&#39;,
            &#39;priv&#39; =&gt; &#39;my_app.create&#39;,
        ],
    ], $CurrentUser);
</code></pre>
<h3 id="smartbar">Smartbar</h3>
<p>There’s a new API for smartbars. If you’ve got a manually constructed smartbar, or one using the old API, you’ll need to move it over. The new API is much better and will enable more functionality.</p>
<pre><code class="lang-php">$Smartbar = new PerchSmartbar($CurrentUser, $HTML, $Lang);

$Smartbar-&gt;add_item([
    &#39;active&#39; =&gt; true,
    &#39;title&#39; =&gt; &#39;Pizza&#39;,
    &#39;link&#39;  =&gt; &#39;/addons/apps/my_app/pizza/&#39;,
]);

echo $Smartbar-&gt;render();
</code></pre>
<h3 id="listings">Listings</h3>
<p>Manual listings can be replaced with the new admin listings API.</p>
<pre><code class="lang-php">$Listing = new PerchAdminListing($CurrentUser, $HTML, $Lang, $Paging);
    $Listing-&gt;add_col([
            &#39;title&#39;     =&gt; &#39;Role&#39;,
            &#39;value&#39;     =&gt; &#39;roleTitle&#39;,
            &#39;sort&#39;      =&gt; &#39;roleTitle&#39;,
            &#39;edit_link&#39; =&gt; &#39;edit&#39;,
        ]);

    $Listing-&gt;add_delete_action([
            &#39;priv&#39;   =&gt; &#39;perch.users.roles.delete&#39;,
            &#39;inline&#39; =&gt; true,
            &#39;path&#39;   =&gt; &#39;delete&#39;,
        ]);

    echo $Listing-&gt;render($roles);
</code></pre>

</article>




</main>
<footer>
</footer>
<script async src="https://cse.google.com/cse.js?cx=007560778035763025039:043iekruiov"></script>
<script src="/assets/js/prism.js" async defer></script>
<script>
    if ("classList" in document.createElement("_")) {
        var hb = document.querySelectorAll('.hamburger');
        if (hb.length) {
            hb[0].addEventListener('click', function(e) {
                e.preventDefault();
                var nav = document.querySelectorAll('nav.primary')[0];
                if (!nav.classList.contains('show')) {
                    nav.classList.remove('show-for-medium', 'hide');
                    nav.classList.add('show');
                } else {
                    nav.classList.remove('show');
                    nav.classList.add('hide');
                }
            });
        }
    }


        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-8618320-3']);
        _gaq.push(['_trackPageview']);

        (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();

</script>
</body>
</html>
